<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <title>Urban Shift Studio - ãƒ­ã‚°ã‚¤ãƒ³</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Noto Sans JP', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #e2e8f0 0%, #f1f5f9 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }

    .login-card {
      background: white;
      border-radius: 20px;
      box-shadow: 0 10px 40px rgba(2, 132, 199, 0.12);
      width: 100%;
      max-width: 420px;
      padding: 40px 32px;
    }

    .login-title {
      background: linear-gradient(135deg, #0284c7, #38bdf8);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-weight: 800;
      font-size: 26px;
      text-align: center;
      margin-bottom: 6px;
    }

    .login-subtitle {
      text-align: center;
      color: #64748b;
      font-size: 13px;
      margin-bottom: 28px;
    }

    /* â•â•â• ã‚¿ãƒ– â•â•â• */
    .auth-tabs {
      display: flex;
      border-bottom: 2px solid #e2e8f0;
      margin-bottom: 24px;
    }

    .auth-tab {
      flex: 1;
      text-align: center;
      padding: 10px 0;
      font-weight: 700;
      font-size: 15px;
      cursor: pointer;
      color: #94a3b8;
      border-bottom: 3px solid transparent;
      margin-bottom: -2px;
      transition: 0.2s;
      user-select: none;
    }

    .auth-tab.active {
      color: #0284c7;
      border-bottom-color: #0284c7;
    }

    /* â•â•â• ãƒ­ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ â•â•â• */
    .role-toggle {
      display: flex;
      gap: 8px;
      background: #f1f5f9;
      padding: 5px;
      border-radius: 10px;
      margin-bottom: 22px;
    }

    .role-btn {
      flex: 1;
      padding: 10px;
      border: none;
      border-radius: 7px;
      background: transparent;
      color: #64748b;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: 0.2s;
    }

    .role-btn.active {
      background: white;
      color: #0284c7;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
    }

    /* â•â•â• ãƒ•ã‚©ãƒ¼ãƒ  â•â•â• */
    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      margin-bottom: 7px;
      color: #334155;
      font-weight: 600;
      font-size: 13px;
    }

    .form-control {
      width: 100%;
      padding: 13px 15px;
      background: #f8fafc;
      border: 1.5px solid #e2e8f0;
      color: #1e293b;
      border-radius: 8px;
      font-size: 15px;
      transition: 0.2s;
      font-family: inherit;
    }

    .form-control:focus {
      background: white;
      border-color: #0284c7;
      box-shadow: 0 0 0 3px rgba(2, 132, 199, 0.1);
      outline: none;
    }

    /* ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›ãƒ©ãƒƒãƒ‘ãƒ¼ */
    .password-wrapper {
      position: relative;
    }

    .password-wrapper .form-control {
      padding-right: 44px;
    }

    .toggle-pw {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      cursor: pointer;
      font-size: 18px;
      user-select: none;
      color: #94a3b8;
      transition: color 0.2s;
    }

    .toggle-pw:hover {
      color: #0284c7;
    }

    /* â•â•â• ãƒœã‚¿ãƒ³ â•â•â• */
    .btn-primary {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #0284c7, #38bdf8);
      border: none;
      color: white;
      font-size: 15px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      transition: 0.2s;
      margin-top: 6px;
      font-family: inherit;
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(2, 132, 199, 0.3);
    }

    .btn-primary:active {
      transform: scale(0.99);
    }

    /* LINE ãƒœã‚¿ãƒ³ */
    .btn-line {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      width: 100%;
      padding: 13px;
      background: #06C755;
      border: none;
      color: white;
      font-size: 15px;
      font-weight: 700;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: 0.2s;
      font-family: inherit;
    }

    .btn-line:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 20px rgba(6, 199, 85, 0.3);
    }

    .divider {
      text-align: center;
      color: #94a3b8;
      font-size: 12px;
      margin: 16px 0;
      position: relative;
    }

    .divider::before,
    .divider::after {
      content: '';
      position: absolute;
      top: 50%;
      width: 42%;
      height: 1px;
      background: #e2e8f0;
    }

    .divider::before {
      left: 0;
    }

    .divider::after {
      right: 0;
    }

    .hint-box {
      margin-top: 20px;
      background: #f8fafc;
      border-radius: 8px;
      padding: 12px 14px;
      font-size: 12px;
      color: #64748b;
      text-align: center;
      line-height: 1.7;
    }
  </style>
</head>

<body>

  <div class="login-card">
    <h1 class="login-title">Urban Shift Studio</h1>
    <p class="login-subtitle">ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›ç­”å‹ã‚·ãƒ•ãƒˆé›†ç´„ã‚·ã‚¹ãƒ†ãƒ </p>

    <!-- ã‚¿ãƒ– -->
    <div class="auth-tabs">
      <div class="auth-tab active" id="tab-login">ãƒ­ã‚°ã‚¤ãƒ³</div>
      <div class="auth-tab" id="tab-register">æ–°è¦ç™»éŒ²</div>
    </div>

    <!-- ãƒ­ãƒ¼ãƒ«é¸æŠ -->
    <div class="role-toggle">
      <button type="button" class="role-btn active" data-role="admin">ğŸ‘‘ ç®¡ç†è€…</button>
      <button type="button" class="role-btn" data-role="staff">ğŸ§‘ ã‚¹ã‚¿ãƒƒãƒ•</button>
    </div>

    <!-- ãƒ•ã‚©ãƒ¼ãƒ  -->
    <form id="authForm" autocomplete="off">

      <!-- æ–°è¦ç™»éŒ²ã®ã¿ï¼šãŠåå‰ -->
      <div class="form-group" id="name-group" style="display:none;">
        <label for="userName">ãŠåå‰ï¼ˆåº—é•·ã«è¡¨ç¤ºã•ã‚Œã¾ã™ï¼‰</label>
        <input type="text" id="userName" class="form-control" placeholder="ä¾‹ï¼šæ¸‹è°· å¤ªéƒ">
      </div>

      <!-- ãƒ­ã‚°ã‚¤ãƒ³ã®ã¿ï¼šãƒ¦ãƒ¼ã‚¶ãƒ¼ID -->
      <div class="form-group" id="userId-group">
        <label for="userId">ãƒ¦ãƒ¼ã‚¶ãƒ¼ID</label>
        <input type="text" id="userId" class="form-control" placeholder="IDã‚’å…¥åŠ›">
      </div>

      <!-- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ï¼ˆå¸¸æ™‚è¡¨ç¤ºï¼‰ -->
      <div class="form-group">
        <label for="password">ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰</label>
        <div class="password-wrapper">
          <input type="password" id="password" class="form-control" placeholder="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›" required>
          <span class="toggle-pw" id="toggle-pw" title="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’è¡¨ç¤º">ğŸ‘ï¸</span>
        </div>
      </div>

      <button type="submit" id="submit-btn" class="btn-primary">ãƒ­ã‚°ã‚¤ãƒ³</button>
    </form>

    <div class="divider">ã¾ãŸã¯</div>

    <!-- LINEãƒ­ã‚°ã‚¤ãƒ³ -->
    <a href="/api/line/login" class="btn-line">
      <svg width="20" height="20" viewBox="0 0 24 24" fill="white">
        <path
          d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .346-.282.631-.63.631-.345 0-.627-.285-.627-.631V8.108c0-.27.174-.51.432-.596.064-.021.138-.033.199-.033.201 0 .391.09.51.252l2.443 3.317V8.108c0-.345.282-.63.63-.63.344 0 .627.285.627.63v4.771zm-5.741 0c0 .346-.282.631-.631.631-.345 0-.627-.285-.627-.631V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.281.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314" />
      </svg>
      LINEã§ãƒ­ã‚°ã‚¤ãƒ³ / æ–°è¦ç™»éŒ²
    </a>

    <div class="hint-box">
      åˆæœŸç®¡ç†è€…: <strong>admin</strong> / <strong>admin123</strong><br>
      ã‚µãƒ³ãƒ—ãƒ«ã‚¹ã‚¿ãƒƒãƒ•: <strong>staff1</strong> ã¾ãŸã¯ <strong>staff2</strong> / <strong>staff123</strong>
    </div>
  </div>

  <!-- login.jsã®ã¿èª­ã¿è¾¼ã‚€ï¼ˆauth.jsã¯ä¸è¦ï¼‰ -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      let isRegisterMode = false;
      let currentRole = 'admin';

      // â”€â”€ ãƒ­ãƒ¼ãƒ«åˆ‡ã‚Šæ›¿ãˆ â”€â”€
      const roleBtns = document.querySelectorAll('.role-btn');
      roleBtns.forEach(btn => {
        btn.addEventListener('click', () => {
          roleBtns.forEach(b => b.classList.remove('active'));
          btn.classList.add('active');
          currentRole = btn.dataset.role;
        });
      });

      // â”€â”€ ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆ â”€â”€
      const tabLogin = document.getElementById('tab-login');
      const tabRegister = document.getElementById('tab-register');
      const nameGroup = document.getElementById('name-group');
      const userIdGroup = document.getElementById('userId-group');
      const userIdInput = document.getElementById('userId');
      const userNameInput = document.getElementById('userName');
      const submitBtn = document.getElementById('submit-btn');

      function switchToLogin() {
        isRegisterMode = false;
        tabLogin.classList.add('active');
        tabRegister.classList.remove('active');
        nameGroup.style.display = 'none';
        userIdGroup.style.display = 'block';
        userIdInput.required = true;
        userNameInput.required = false;
        submitBtn.textContent = 'ãƒ­ã‚°ã‚¤ãƒ³';
      }

      function switchToRegister() {
        isRegisterMode = true;
        tabRegister.classList.add('active');
        tabLogin.classList.remove('active');
        nameGroup.style.display = 'block';
        userIdGroup.style.display = 'none';
        userIdInput.required = false;
        userNameInput.required = true;
        submitBtn.textContent = 'æ–°è¦ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³';
      }

      tabLogin.addEventListener('click', switchToLogin);
      tabRegister.addEventListener('click', switchToRegister);

      // â”€â”€ ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰è¡¨ç¤º/éè¡¨ç¤º â”€â”€
      const pwInput = document.getElementById('password');
      const togglePw = document.getElementById('toggle-pw');
      togglePw.addEventListener('click', () => {
        const isHidden = pwInput.type === 'password';
        pwInput.type = isHidden ? 'text' : 'password';
        togglePw.textContent = isHidden ? 'ğŸ™ˆ' : 'ğŸ‘ï¸';
      });

      // â”€â”€ ãƒ•ã‚©ãƒ¼ãƒ é€ä¿¡ â”€â”€
      document.getElementById('authForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        submitBtn.disabled = true;
        submitBtn.textContent = 'å‡¦ç†ä¸­...';

        const password = pwInput.value.trim();
        const name = userNameInput.value.trim();
        const userId = userIdInput.value.trim();

        try {
          if (isRegisterMode) {
            // æ–°è¦ç™»éŒ²
            if (!name) { alert('ãŠåå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            if (!password) { alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            const generatedUserId = 'user_' + Math.random().toString(36).substring(2, 8);
            const res = await fetch('/api/register', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ username: generatedUserId, password, name, role: currentRole })
            });
            const data = await res.json();
            if (res.ok || data.success) {
              alert(`ğŸ‰ ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆæˆåŠŸï¼\n\nã‚ãªãŸã®IDã¯ã€Œ ${generatedUserId} ã€ã§ã™ã€‚\næ¬¡å›ãƒ­ã‚°ã‚¤ãƒ³æ™‚ã«å¿…è¦ãªã®ã§ãƒ¡ãƒ¢ã—ã¦ãã ã•ã„ã€‚`);
              window.location.href = currentRole === 'admin' ? '/admin/index.html' : '/staff/index.html';
            } else {
              alert(data.error || data.message || 'ç™»éŒ²ã«å¤±æ•—ã—ã¾ã—ãŸ');
            }
          } else {
            // ãƒ­ã‚°ã‚¤ãƒ³
            if (!userId) { alert('ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            if (!password) { alert('ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }
            const res = await fetch('/api/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
              body: JSON.stringify({ userId, password, role: currentRole })
            });
            const data = await res.json();
            if (res.ok || data.success) {
              window.location.href = currentRole === 'admin' ? '/admin/index.html' : '/staff/index.html';
            } else {
              alert(data.message || 'IDã¾ãŸã¯ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™');
            }
          }
        } catch (err) {
          alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ');
        } finally {
          submitBtn.disabled = false;
          switchToLogin();
          submitBtn.textContent = isRegisterMode ? 'æ–°è¦ç™»éŒ²ã—ã¦ãƒ­ã‚°ã‚¤ãƒ³' : 'ãƒ­ã‚°ã‚¤ãƒ³';
        }
      });
    });
  </script>

</body>

</html>